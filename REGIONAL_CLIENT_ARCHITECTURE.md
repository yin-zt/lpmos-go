# Regional Client å®Œæ•´æž¶æž„è®¾è®¡

## ðŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æž¶æž„æ€»è§ˆ](#æž¶æž„æ€»è§ˆ)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [å®Œæ•´å·¥ä½œæµç¨‹](#å®Œæ•´å·¥ä½œæµç¨‹)
- [æ•°æ®ç»“æž„](#æ•°æ®ç»“æž„)
- [API æŽ¥å£](#api-æŽ¥å£)
- [é…ç½®è¯´æ˜Ž](#é…ç½®è¯´æ˜Ž)
- [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)

---

## æ¦‚è¿°

Regional Client æ˜¯ LPMOS ç³»ç»Ÿçš„**æœºæˆ¿å®¢æˆ·ç«¯**ï¼Œè´Ÿè´£æ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„è£…æœºè‡ªåŠ¨åŒ–ã€‚å®ƒæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„æœåŠ¡ç»„ä»¶ï¼Œé›†æˆäº† DHCPã€TFTPã€äº¤æ¢æœºç®¡ç†ã€BMC æŽ§åˆ¶ç­‰åŠŸèƒ½ã€‚

### ä¸»è¦èŒè´£

1. **ç›‘å¬ etcd** - å®žæ—¶ç›‘æŽ§è£…æœºä»»åŠ¡å˜åŒ–
2. **ç½‘ç»œç®¡ç†** - è‡ªåŠ¨é…ç½®äº¤æ¢æœºç«¯å£å’Œ VLAN
3. **PXE æœåŠ¡** - æä¾› DHCP å’Œ TFTP æœåŠ¡
4. **æœåŠ¡å™¨æŽ§åˆ¶** - é€šè¿‡ BMC/IPMI è¿œç¨‹æŽ§åˆ¶æœåŠ¡å™¨
5. **Agent é€šä¿¡** - ä¸º Agent æä¾› REST API æœåŠ¡
6. **çŠ¶æ€åŒæ­¥** - å°†è£…æœºè¿›åº¦åŒæ­¥å›ž etcd

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.22+
- **Web æ¡†æž¶**: Gin
- **æ•°æ®å­˜å‚¨**: etcd v3
- **ç½‘ç»œæœåŠ¡**: DHCP4, TFTP
- **è¿œç¨‹ç®¡ç†**: SSH, SNMP, IPMI, Redfish
- **é…ç½®æ ¼å¼**: YAML

---

## æž¶æž„æ€»è§ˆ

### ç³»ç»Ÿæž¶æž„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Regional Client                                 â”‚
â”‚                      (æœºæˆ¿å®¢æˆ·ç«¯ - å¤šåŠŸèƒ½æœåŠ¡)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  etcd ç›‘å¬   â”‚           â”‚  Agent API   â”‚           â”‚  ç½‘ç»œæœåŠ¡    â”‚
â”‚  æ¨¡å—        â”‚           â”‚  æœåŠ¡å™¨      â”‚           â”‚  (DHCP/TFTP) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç›‘å¬ä»»åŠ¡   â”‚           â”‚ â€¢ ç¡¬ä»¶ä¸ŠæŠ¥   â”‚           â”‚ â€¢ DHCP æœåŠ¡å™¨â”‚
â”‚ â€¢ ç›‘å¬æœåŠ¡å™¨ â”‚           â”‚ â€¢ é˜Ÿåˆ—æŸ¥è¯¢   â”‚           â”‚ â€¢ TFTP æœåŠ¡å™¨â”‚
â”‚ â€¢ å®žæ—¶å“åº”   â”‚           â”‚ â€¢ æ“ä½œæŸ¥è¯¢   â”‚           â”‚ â€¢ PXE é…ç½®   â”‚
â”‚ â€¢ è§¦å‘æµç¨‹   â”‚           â”‚ â€¢ è¿›åº¦ä¸ŠæŠ¥   â”‚           â”‚ â€¢ é•œåƒç®¡ç†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº¤æ¢æœºç®¡ç†   â”‚           â”‚  BMC æŽ§åˆ¶    â”‚           â”‚  PXE é…ç½®    â”‚
â”‚ æ¨¡å—         â”‚           â”‚  æ¨¡å—        â”‚           â”‚  ç”Ÿæˆå™¨      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Cisco      â”‚           â”‚ â€¢ IPMI       â”‚           â”‚ â€¢ å¯åŠ¨èœå•   â”‚
â”‚ â€¢ Huawei     â”‚           â”‚ â€¢ Redfish    â”‚           â”‚ â€¢ å†…æ ¸å‚æ•°   â”‚
â”‚ â€¢ H3C        â”‚           â”‚ â€¢ ç”µæºæŽ§åˆ¶   â”‚           â”‚ â€¢ ç½‘ç»œé…ç½®   â”‚
â”‚ â€¢ Arista     â”‚           â”‚ â€¢ å¯åŠ¨è®¾å¤‡   â”‚           â”‚ â€¢ Agent é…ç½® â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                            å¯¹å¤–æŽ¥å£/è®¾å¤‡
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   etcd   â”‚              â”‚ äº¤æ¢æœº    â”‚              â”‚ æœåŠ¡å™¨    â”‚
  â”‚ é›†ç¾¤å­˜å‚¨ â”‚              â”‚ (ä¸Šè”)   â”‚              â”‚ (BMC/PXE) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Regional Client                          â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Core Engine                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚etcd Watcherâ”‚  â”‚Task Managerâ”‚  â”‚  Scheduler â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚        â”‚                â”‚                â”‚              â”‚ â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Service Layer (æœåŠ¡å±‚)                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚DHCP      â”‚  â”‚TFTP      â”‚  â”‚HTTP API  â”‚  â”‚Metrics  â”‚â”‚ â”‚
â”‚  â”‚  â”‚Server    â”‚  â”‚Server    â”‚  â”‚Server    â”‚  â”‚Exporter â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚Switch    â”‚  â”‚BMC       â”‚  â”‚PXE       â”‚  â”‚Storage  â”‚â”‚ â”‚
â”‚  â”‚  â”‚Manager   â”‚  â”‚Controllerâ”‚  â”‚Generator â”‚  â”‚Manager  â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. etcd ç›‘å¬æ¨¡å— (Watcher)

**åŠŸèƒ½**: å®žæ—¶ç›‘å¬ etcd ä¸­çš„ä»»åŠ¡å’ŒæœåŠ¡å™¨å˜åŒ–

```go
type WatcherManager struct {
    etcdClient *etcd.Client
    idc        string
    ctx        context.Context
    handlers   map[string]EventHandler
}

// ç›‘å¬ä»»åŠ¡å˜åŒ–
func (w *WatcherManager) WatchTasks() {
    prefix := fmt.Sprintf("/os/%s/machines/", w.idc)
    watchChan := w.etcdClient.Watch(w.ctx, prefix, true)

    for watchResp := range watchChan {
        for _, event := range watchResp.Events {
            switch event.Type {
            case clientv3.EventTypePut:
                w.handleTaskUpdate(event)
            case clientv3.EventTypeDelete:
                w.handleTaskDelete(event)
            }
        }
    }
}

// ç›‘å¬æœåŠ¡å™¨å˜åŒ–
func (w *WatcherManager) WatchServers() {
    prefix := fmt.Sprintf("/os/%s/servers/", w.idc)
    // ç±»ä¼¼å®žçŽ°
}
```

**è§¦å‘äº‹ä»¶**:
- ä»»åŠ¡å®¡æ‰¹ (`status: pending â†’ approved`)
- ä»»åŠ¡çŠ¶æ€å˜æ›´ (`approved â†’ installing â†’ completed`)
- æœåŠ¡å™¨æ³¨å†Œ
- è¿›åº¦æ›´æ–°

### 2. DHCP æœåŠ¡å™¨æ¨¡å—

**åŠŸèƒ½**: ä¸º PXE å¯åŠ¨çš„æœåŠ¡å™¨åˆ†é… IP åœ°å€

```go
package dhcp

type DHCPServer struct {
    Interface    string           // ç›‘å¬ç½‘å¡ (å¦‚ eth1)
    IPPool       *IPPool          // IP åœ°å€æ± 
    Gateway      string           // é»˜è®¤ç½‘å…³
    DNSServers   []string         // DNS æœåŠ¡å™¨
    TFTPServer   string           // TFTP æœåŠ¡å™¨åœ°å€
    BootFile     string           // å¯åŠ¨æ–‡ä»¶ (pxelinux.0)
    Leases       map[string]*Lease // MAC â†’ Lease æ˜ å°„
    StaticBinds  map[string]*StaticBinding // é™æ€ç»‘å®š
    mu           sync.RWMutex
}

type Lease struct {
    MAC        string
    IP         net.IP
    Hostname   string
    ExpireTime time.Time
}

type StaticBinding struct {
    MAC        string
    IP         net.IP
    Hostname   string
    BootFile   string  // å¯ä»¥ä¸ºæ¯ä¸ª MAC æŒ‡å®šä¸åŒçš„å¯åŠ¨æ–‡ä»¶
}

func NewDHCPServer(config DHCPConfig) (*DHCPServer, error)
func (s *DHCPServer) Start() error
func (s *DHCPServer) Stop() error
func (s *DHCPServer) AddStaticBinding(mac, ip, bootfile string) error
func (s *DHCPServer) RemoveBinding(mac string) error
func (s *DHCPServer) GetLease(mac string) (*Lease, error)
```

**DHCP å“åº”ç¤ºä¾‹**:
```
DHCP Offer:
  Your IP: 192.168.100.10
  Server IP: 192.168.100.1
  Gateway: 192.168.100.1
  DNS: 192.168.100.1
  TFTP Server: 192.168.100.1
  Boot File: pxelinux.0
  Lease Time: 3600s
```

**å®žçŽ°æ–¹å¼**:
- ä½¿ç”¨ `github.com/krolaw/dhcp4` åº“
- ç›‘å¬ UDP 67 ç«¯å£
- æ”¯æŒé™æ€ MAC-IP ç»‘å®š
- æ”¯æŒåŠ¨æ€ IP åˆ†é…

### 3. TFTP æœåŠ¡å™¨æ¨¡å—

**åŠŸèƒ½**: æä¾› PXE å¯åŠ¨æ–‡ä»¶å’Œé•œåƒä¸‹è½½

```go
package tftp

type TFTPServer struct {
    RootDir    string           // æ ¹ç›®å½• (/tftpboot)
    ListenAddr string           // ç›‘å¬åœ°å€ (:69)
    MaxClients int              // æœ€å¤§å¹¶å‘å®¢æˆ·ç«¯
    Timeout    time.Duration    // ä¼ è¾“è¶…æ—¶
    BlockSize  int              // å—å¤§å° (512 bytes)
}

func NewTFTPServer(rootDir string) (*TFTPServer, error)
func (s *TFTPServer) Start() error
func (s *TFTPServer) Stop() error
func (s *TFTPServer) ServeFile(path string) ([]byte, error)
func (s *TFTPServer) ListFiles() []string
```

**ç›®å½•ç»“æž„**:
```
/tftpboot/
â”œâ”€â”€ pxelinux.0              # PXE å¼•å¯¼ç¨‹åº (Syslinux)
â”œâ”€â”€ ldlinux.c32             # Syslinux ä¾èµ–åº“
â”œâ”€â”€ menu.c32                # èœå•æ¨¡å—
â”œâ”€â”€ vesamenu.c32            # å›¾å½¢èœå•
â”œâ”€â”€ libutil.c32             # å·¥å…·åº“
â”œâ”€â”€ kernels/                # å†…æ ¸é•œåƒ
â”‚   â”œâ”€â”€ vmlinuz-ubuntu-22.04
â”‚   â”œâ”€â”€ vmlinuz-centos-7
â”‚   â””â”€â”€ vmlinuz-rocky-9
â”œâ”€â”€ initrds/                # Initrd é•œåƒ (åŒ…å« Agent)
â”‚   â”œâ”€â”€ initrd-ubuntu-22.04.img
â”‚   â”œâ”€â”€ initrd-centos-7.img
â”‚   â””â”€â”€ initrd-rocky-9.img
â””â”€â”€ pxelinux.cfg/           # PXE é…ç½®æ–‡ä»¶
    â”œâ”€â”€ default             # é»˜è®¤é…ç½®
    â””â”€â”€ 01-{mac-addr}       # æŒ‰ MAC åœ°å€çš„é…ç½®
```

**PXE å¯åŠ¨æµç¨‹**:
1. BIOS åŠ è½½ `pxelinux.0`
2. pxelinux è¯»å– `/pxelinux.cfg/01-{mac}` æˆ– `default`
3. ä¸‹è½½ `vmlinuz` (å†…æ ¸)
4. ä¸‹è½½ `initrd.img` (å†…å­˜æ–‡ä»¶ç³»ç»Ÿ)
5. å¯åŠ¨ Linux å†…æ ¸

### 4. äº¤æ¢æœºç®¡ç†æ¨¡å—

**åŠŸèƒ½**: è‡ªåŠ¨é…ç½®æœåŠ¡å™¨è¿žæŽ¥çš„äº¤æ¢æœºç«¯å£

```go
package switch_mgmt

type SwitchManager interface {
    Connect() error
    Disconnect() error
    FindPortByMAC(mac string) (port string, err error)
    ConfigurePort(port string, config PortConfig) error
    GetPortStatus(port string) (*PortStatus, error)
    GetPortVLAN(port string) ([]int, error)
}

type PortConfig struct {
    Mode       string   // access, trunk
    VLANs      []int    // VLAN IDs
    NativeVLAN int      // Native VLAN for trunk
    Description string
}

type PortStatus struct {
    Port        string
    Status      string   // up, down
    Speed       string   // 1G, 10G, 25G
    Duplex      string   // full, half
    VLANs       []int
}

// Cisco äº¤æ¢æœºå®žçŽ°
type CiscoSwitch struct {
    Host     string
    Username string
    Password string
    client   *ssh.Client
}

func (c *CiscoSwitch) Connect() error
func (c *CiscoSwitch) FindPortByMAC(mac string) (string, error) {
    // show mac address-table | include {mac}
}
func (c *CiscoSwitch) ConfigurePort(port string, config PortConfig) error {
    // interface {port}
    // switchport mode access
    // switchport access vlan {vlan}
}

// Huawei äº¤æ¢æœºå®žçŽ°
type HuaweiSwitch struct { /* ç±»ä¼¼å®žçŽ° */ }

// H3C äº¤æ¢æœºå®žçŽ°
type H3CSwitch struct { /* ç±»ä¼¼å®žçŽ° */ }
```

**æ”¯æŒçš„æ“ä½œ**:
- é€šè¿‡ MAC åœ°å€æŸ¥æ‰¾ç«¯å£
- é…ç½®ç«¯å£ VLAN
- è®¾ç½®ç«¯å£ä¸º Access/Trunk æ¨¡å¼
- æŸ¥è¯¢ç«¯å£çŠ¶æ€
- é…ç½®ç«¯å£æè¿°

**è¿žæŽ¥æ–¹å¼**:
- **SSH**: é€‚ç”¨äºŽ Cisco, Huawei, H3C
- **SNMP**: é€‚ç”¨äºŽå¤§éƒ¨åˆ†äº¤æ¢æœº
- **REST API**: é€‚ç”¨äºŽ Arista EOS

### 5. BMC/IPMI æŽ§åˆ¶æ¨¡å—

**åŠŸèƒ½**: è¿œç¨‹æŽ§åˆ¶æœåŠ¡å™¨ç”µæºå’Œå¯åŠ¨è®¾å¤‡

```go
package bmc

type BMCController interface {
    Connect() error
    Disconnect() error
    GetPowerStatus() (string, error)     // on, off
    PowerOn() error
    PowerOff() error
    PowerReset() error
    SetBootDevice(device BootDevice) error
    GetBootDevice() (BootDevice, error)
    GetSystemInfo() (*SystemInfo, error)
}

type BootDevice string

const (
    BootDevicePXE     BootDevice = "pxe"
    BootDeviceDisk    BootDevice = "disk"
    BootDeviceCDROM   BootDevice = "cdrom"
    BootDeviceBIOS    BootDevice = "bios"
)

type SystemInfo struct {
    Manufacturer string
    ProductName  string
    SerialNumber string
    FirmwareVersion string
}

// IPMI å®žçŽ° (ipmitool)
type IPMIController struct {
    Host     string
    Username string
    Password string
}

func (i *IPMIController) PowerOn() error {
    return exec.Command("ipmitool", "-H", i.Host,
        "-U", i.Username, "-P", i.Password,
        "power", "on").Run()
}

func (i *IPMIController) SetBootDevice(device BootDevice) error {
    return exec.Command("ipmitool", "-H", i.Host,
        "-U", i.Username, "-P", i.Password,
        "chassis", "bootdev", string(device)).Run()
}

// Redfish å®žçŽ° (REST API)
type RedfishController struct {
    BaseURL  string
    Username string
    Password string
    client   *http.Client
}

func (r *RedfishController) PowerOn() error {
    // POST /redfish/v1/Systems/1/Actions/ComputerSystem.Reset
    // {"ResetType": "On"}
}
```

**IPMI å‘½ä»¤ç¤ºä¾‹**:
```bash
# æŸ¥è¯¢ç”µæºçŠ¶æ€
ipmitool -H 192.168.1.100 -U admin -P password power status

# å¼€æœº
ipmitool -H 192.168.1.100 -U admin -P password power on

# è®¾ç½®ä»Ž PXE å¯åŠ¨
ipmitool -H 192.168.1.100 -U admin -P password chassis bootdev pxe

# é‡å¯
ipmitool -H 192.168.1.100 -U admin -P password power reset
```

### 6. PXE é…ç½®ç”Ÿæˆå™¨

**åŠŸèƒ½**: æ ¹æ®ä»»åŠ¡é…ç½®ç”Ÿæˆ PXE å¯åŠ¨èœå•

```go
package pxe

type PXEGenerator struct {
    TFTPRoot   string
    ConfigDir  string  // /tftpboot/pxelinux.cfg
    KernelDir  string  // /tftpboot/kernels
    InitrdDir  string  // /tftpboot/initrds
}

type PXEConfig struct {
    MAC           string
    IP            string
    Hostname      string
    OSType        string
    OSVersion     string
    KernelPath    string
    InitrdPath    string
    KernelParams  string
    RegionalURL   string
}

func (g *PXEGenerator) Generate(config PXEConfig) error
func (g *PXEGenerator) Remove(mac string) error
func (g *PXEGenerator) GetConfig(mac string) (*PXEConfig, error)
```

**ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ç¤ºä¾‹** (`/tftpboot/pxelinux.cfg/01-00-1a-2b-3c-4d-5e`):
```
DEFAULT linux
LABEL linux
    KERNEL kernels/vmlinuz-ubuntu-22.04
    APPEND initrd=initrds/initrd-ubuntu-22.04.img \
           ip=dhcp \
           console=tty0 console=ttyS0,115200n8 \
           regional_url=http://192.168.100.1:8081 \
           auto_install=true \
           sn=auto
TIMEOUT 50
PROMPT 0
```

**é…ç½®æ¨¡æ¿**:
```go
const pxeConfigTemplate = `DEFAULT linux
LABEL linux
    KERNEL {{.KernelPath}}
    APPEND initrd={{.InitrdPath}} {{.KernelParams}}
TIMEOUT 50
PROMPT 0
`
```

---

## å®Œæ•´å·¥ä½œæµç¨‹

### æµç¨‹ 1: ä»»åŠ¡å®¡æ‰¹è§¦å‘è‡ªåŠ¨è£…æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·åœ¨ Control Plane å®¡æ‰¹ä»»åŠ¡                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Control Plane æ›´æ–° etcd                                      â”‚
â”‚    /os/dc1/machines/sn-001/task                                 â”‚
â”‚    {"status": "approved", ...}                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Regional Client Watcher æ£€æµ‹åˆ°ä»»åŠ¡å®¡æ‰¹                       â”‚
â”‚    è§¦å‘ handleApprovedTask()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é…ç½®äº¤æ¢æœºç«¯å£ (SwitchManager)                               â”‚
â”‚    â€¢ é€šè¿‡ MAC åœ°å€æŸ¥æ‰¾ç«¯å£                                      â”‚
â”‚    â€¢ é…ç½®ç«¯å£åˆ°è£…æœº VLAN (å¦‚ VLAN 100)                          â”‚
â”‚    â€¢ è®¾ç½®ä¸º Access æ¨¡å¼                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿæˆ PXE é…ç½® (PXEGenerator)                                 â”‚
â”‚    â€¢ åˆ›å»º /tftpboot/pxelinux.cfg/01-{mac}                       â”‚
â”‚    â€¢ æŒ‡å®šå†…æ ¸ã€initrd è·¯å¾„                                      â”‚
â”‚    â€¢ é…ç½®å¯åŠ¨å‚æ•° (regional_url, sn, etc.)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ·»åŠ  DHCP é™æ€ç»‘å®š (DHCPServer)                              â”‚
â”‚    â€¢ MAC â†’ IP æ˜ å°„                                              â”‚
â”‚    â€¢ æŒ‡å®š TFTP æœåŠ¡å™¨åœ°å€                                       â”‚
â”‚    â€¢ æŒ‡å®šå¯åŠ¨æ–‡ä»¶ pxelinux.0                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æŽ§åˆ¶æœåŠ¡å™¨é‡å¯ (BMCController)                               â”‚
â”‚    â€¢ è¿žæŽ¥ BMC (IPMI/Redfish)                                    â”‚
â”‚    â€¢ è®¾ç½®å¯åŠ¨è®¾å¤‡ä¸º PXE                                         â”‚
â”‚    â€¢ æ‰§è¡Œ Power Reset                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. æœåŠ¡å™¨ PXE å¯åŠ¨                                              â”‚
â”‚    â€¢ BIOS æ£€æµ‹åˆ° PXE å¯åŠ¨                                       â”‚
â”‚    â€¢ å‘é€ DHCP Discover                                         â”‚
â”‚    â€¢ æŽ¥æ”¶ DHCP Offer (IP + TFTP æœåŠ¡å™¨)                         â”‚
â”‚    â€¢ é€šè¿‡ TFTP ä¸‹è½½ pxelinux.0                                  â”‚
â”‚    â€¢ è¯»å– PXE é…ç½®æ–‡ä»¶                                          â”‚
â”‚    â€¢ ä¸‹è½½å†…æ ¸å’Œ initrd                                          â”‚
â”‚    â€¢ å¯åŠ¨åˆ°å†…å­˜ç³»ç»Ÿ                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Agent åœ¨å†…å­˜ç³»ç»Ÿä¸­å¯åŠ¨                                       â”‚
â”‚    â€¢ ç½‘ç»œå·²é€šè¿‡ DHCP é…ç½®                                       â”‚
â”‚    â€¢ è¯»å–å†…æ ¸å‚æ•°èŽ·å– regional_url                              â”‚
â”‚    â€¢ é‡‡é›†ç¡¬ä»¶ä¿¡æ¯                                               â”‚
â”‚    â€¢ ä¸ŠæŠ¥åˆ° Regional Client                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. Agent è¿›å…¥æ“ä½œå¾ªçŽ¯                                          â”‚
â”‚     â€¢ isInInstallQueue â†’ true                                   â”‚
â”‚     â€¢ getNextOperation â†’ hardware_config/os_install/...         â”‚
â”‚     â€¢ æ‰§è¡Œæ“ä½œå¹¶æŠ¥å‘Šå®Œæˆ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. è£…æœºå®Œæˆæ¸…ç† (Regional Client)                              â”‚
â”‚     â€¢ æ¢å¤äº¤æ¢æœºç«¯å£é…ç½® (ç§»å…¥ç”Ÿäº§ VLAN)                        â”‚
â”‚     â€¢ åˆ é™¤ DHCP é™æ€ç»‘å®š                                        â”‚
â”‚     â€¢ åˆ é™¤ PXE é…ç½®æ–‡ä»¶                                         â”‚
â”‚     â€¢ æ›´æ–° etcd: task.status = "completed"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµç¨‹ 2: Agent å¯åŠ¨åŽçš„é€šä¿¡æµç¨‹

```
Agent (å†…å­˜ç³»ç»Ÿ)                Regional Client              etcd
    â”‚                                  â”‚                      â”‚
    â”‚ [1] POST /api/v1/report          â”‚                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
    â”‚     {sn, mac, hardware}          â”‚                      â”‚
    â”‚                                  â”‚ [2] å†™å…¥æœåŠ¡å™¨ä¿¡æ¯   â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                  â”‚ /os/dc1/servers/{sn} â”‚
    â”‚                                  â”‚                      â”‚
    â”‚                                  â”‚ [3] æ›´æ–°ä»»åŠ¡         â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                  â”‚ /os/dc1/machines/... â”‚
    â”‚ [4] Response: OK                 â”‚                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
    â”‚                                  â”‚                      â”‚
    â”‚ [5] POST /api/v1/device/isInInstallQueue               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
    â”‚     {sn}                         â”‚                      â”‚
    â”‚                                  â”‚ [6] æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€     â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                  â”‚ GetJSON(taskKey)     â”‚
    â”‚                                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                  â”‚ task.status="approved"â”‚
    â”‚ [7] Response: {result: true}     â”‚                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
    â”‚                                  â”‚                      â”‚
    â”‚ [8] POST /api/v1/device/getNextOperation               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
    â”‚     {sn}                         â”‚                      â”‚
    â”‚                                  â”‚ [9] æŸ¥è¯¢ä»»åŠ¡è¿›åº¦     â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                  â”‚ GetJSON(taskKey)     â”‚
    â”‚                                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ [10] Response: {operation: "hardware_config"}           â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
    â”‚                                  â”‚                      â”‚
    â”‚ [11] POST /api/v1/device/getHardwareConfig             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
    â”‚ [12] Response: {scripts: [...]}  â”‚                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
    â”‚                                  â”‚                      â”‚
    â”‚ [æ‰§è¡Œç¡¬ä»¶é…ç½®è„šæœ¬]                â”‚                      â”‚
    â”‚                                  â”‚                      â”‚
    â”‚ [13] POST /api/v1/device/operationComplete             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
    â”‚     {sn, operation, success}     â”‚                      â”‚
    â”‚                                  â”‚ [14] æ›´æ–°ä»»åŠ¡è¿›åº¦    â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                  â”‚ AtomicUpdate(taskKey)â”‚
    â”‚ [15] Response: OK                â”‚                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
    â”‚                                  â”‚                      â”‚
    â”‚ [å¾ªçŽ¯: getNextOperation â†’ æ‰§è¡Œ â†’ operationComplete]     â”‚
    â”‚                                  â”‚                      â”‚
```

---

## æ•°æ®ç»“æž„

### Regional Client é…ç½®

```yaml
# regional-client.yaml
idc: "dc1"
api_port: 8081

etcd:
  endpoints:
    - "localhost:2379"
  dial_timeout: 5s
  request_timeout: 10s

dhcp:
  enabled: true
  interface: "eth1"
  ip_range:
    start: "192.168.100.10"
    end: "192.168.100.200"
  gateway: "192.168.100.1"
  dns_servers:
    - "192.168.100.1"
    - "8.8.8.8"
  tftp_server: "192.168.100.1"
  boot_file: "pxelinux.0"
  lease_time: "3600s"

tftp:
  enabled: true
  root_dir: "/tftpboot"
  listen_addr: ":69"
  max_clients: 100
  timeout: "30s"
  block_size: 512

switch:
  enabled: true
  type: "cisco"  # cisco, huawei, h3c, arista
  host: "192.168.1.1"
  username: "admin"
  password: "password"
  protocol: "ssh"  # ssh, snmp, rest
  install_vlan: 100
  production_vlan: 200

bmc:
  enabled: true
  protocol: "ipmi"  # ipmi, redfish
  default_username: "admin"
  default_password: "password"
  timeout: "30s"

pxe:
  config_dir: "/tftpboot/pxelinux.cfg"
  kernel_dir: "/tftpboot/kernels"
  initrd_dir: "/tftpboot/initrds"
  default_kernel_params: "console=tty0 console=ttyS0,115200n8 ip=dhcp"

logging:
  level: "info"
  file: "/var/log/regional-client.log"
  max_size: 100  # MB
  max_backups: 10
  max_age: 30  # days
```

### Task æ‰©å±•å­—æ®µ

```go
type TaskV3 struct {
    TaskID     string       `json:"task_id"`
    SN         string       `json:"sn"`
    MAC        string       `json:"mac"`
    Status     TaskStatus   `json:"status"`

    // ç½‘ç»œé…ç½®
    Network    *NetworkConfig `json:"network,omitempty"`

    // BMC é…ç½®
    BMC        *BMCConfig     `json:"bmc,omitempty"`

    // äº¤æ¢æœºé…ç½®
    Switch     *SwitchConfig  `json:"switch,omitempty"`

    // PXE é…ç½®
    PXE        *PXEConfig     `json:"pxe,omitempty"`

    // ... å…¶ä»–å­—æ®µ
}

type NetworkConfig struct {
    IP         string   `json:"ip"`
    Netmask    string   `json:"netmask"`
    Gateway    string   `json:"gateway"`
    DNSServers []string `json:"dns_servers"`
    VLANs      []int    `json:"vlans"`
}

type BMCConfig struct {
    IP       string `json:"ip"`
    Username string `json:"username"`
    Password string `json:"password"`
    Type     string `json:"type"`  // ipmi, redfish
}

type SwitchConfig struct {
    Port     string `json:"port"`
    VLANs    []int  `json:"vlans"`
    Mode     string `json:"mode"`  // access, trunk
}

type PXEConfig struct {
    KernelPath   string `json:"kernel_path"`
    InitrdPath   string `json:"initrd_path"`
    KernelParams string `json:"kernel_params"`
}
```

---

## API æŽ¥å£

### Agent API (å·²å®žçŽ°)

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜Ž |
|------|------|------|
| `/api/v1/report` | POST | Agent ä¸ŠæŠ¥ç¡¬ä»¶ä¿¡æ¯ |
| `/api/v1/device/isInInstallQueue` | POST | æŸ¥è¯¢æ˜¯å¦åœ¨è£…æœºé˜Ÿåˆ— |
| `/api/v1/device/getNextOperation` | POST | èŽ·å–ä¸‹ä¸€æ­¥æ“ä½œ |
| `/api/v1/device/getHardwareConfig` | POST | èŽ·å–ç¡¬ä»¶é…ç½®è„šæœ¬ |
| `/api/v1/device/operationComplete` | POST | æŠ¥å‘Šæ“ä½œå®Œæˆ |
| `/api/v1/progress` | POST | ä¸ŠæŠ¥å®‰è£…è¿›åº¦ |

### ç®¡ç† API (æ–°å¢ž)

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜Ž |
|------|------|------|
| `/api/v1/admin/dhcp/leases` | GET | æŸ¥è¯¢ DHCP ç§Ÿçº¦åˆ—è¡¨ |
| `/api/v1/admin/dhcp/binding` | POST | æ·»åŠ é™æ€ç»‘å®š |
| `/api/v1/admin/dhcp/binding/:mac` | DELETE | åˆ é™¤é™æ€ç»‘å®š |
| `/api/v1/admin/tftp/files` | GET | åˆ—å‡º TFTP æ–‡ä»¶ |
| `/api/v1/admin/pxe/configs` | GET | åˆ—å‡º PXE é…ç½® |
| `/api/v1/admin/pxe/config/:mac` | GET | èŽ·å–æŒ‡å®š MAC çš„ PXE é…ç½® |
| `/api/v1/admin/pxe/config/:mac` | DELETE | åˆ é™¤ PXE é…ç½® |
| `/api/v1/admin/switch/ports` | GET | æŸ¥è¯¢äº¤æ¢æœºç«¯å£åˆ—è¡¨ |
| `/api/v1/admin/switch/port/:port` | GET | èŽ·å–ç«¯å£è¯¦æƒ… |
| `/api/v1/admin/bmc/:sn/power` | GET | æŸ¥è¯¢æœåŠ¡å™¨ç”µæºçŠ¶æ€ |
| `/api/v1/admin/bmc/:sn/power` | POST | æŽ§åˆ¶æœåŠ¡å™¨ç”µæº |
| `/api/v1/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/v1/metrics` | GET | Prometheus æŒ‡æ ‡ |

---

## é…ç½®è¯´æ˜Ž

### 1. DHCP é…ç½®

```yaml
dhcp:
  enabled: true
  interface: "eth1"           # ç›‘å¬ç½‘å¡
  ip_range:
    start: "192.168.100.10"   # IP æ± èµ·å§‹
    end: "192.168.100.200"    # IP æ± ç»“æŸ
  gateway: "192.168.100.1"    # é»˜è®¤ç½‘å…³
  dns_servers:
    - "192.168.100.1"         # DNS æœåŠ¡å™¨
  tftp_server: "192.168.100.1"  # TFTP æœåŠ¡å™¨åœ°å€
  boot_file: "pxelinux.0"     # å¯åŠ¨æ–‡ä»¶
  lease_time: "3600s"         # ç§Ÿçº¦æ—¶é—´
```

### 2. TFTP é…ç½®

```yaml
tftp:
  enabled: true
  root_dir: "/tftpboot"       # TFTP æ ¹ç›®å½•
  listen_addr: ":69"          # ç›‘å¬åœ°å€
  max_clients: 100            # æœ€å¤§å¹¶å‘å®¢æˆ·ç«¯
  timeout: "30s"              # ä¼ è¾“è¶…æ—¶
  block_size: 512             # å—å¤§å°
```

### 3. äº¤æ¢æœºé…ç½®

```yaml
switch:
  enabled: true
  type: "cisco"               # äº¤æ¢æœºç±»åž‹
  host: "192.168.1.1"        # ç®¡ç†åœ°å€
  username: "admin"
  password: "password"
  protocol: "ssh"             # è¿žæŽ¥åè®®
  install_vlan: 100           # è£…æœº VLAN
  production_vlan: 200        # ç”Ÿäº§ VLAN
```

### 4. BMC é…ç½®

```yaml
bmc:
  enabled: true
  protocol: "ipmi"            # åè®®ç±»åž‹
  default_username: "admin"   # é»˜è®¤ç”¨æˆ·å
  default_password: "password"  # é»˜è®¤å¯†ç 
  timeout: "30s"              # æ“ä½œè¶…æ—¶
```

---

## éƒ¨ç½²æ–¹æ¡ˆ

### å•æœºæˆ¿éƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Center (DC1)                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Regional Clientâ”‚         â”‚  Core Switch     â”‚       â”‚
â”‚  â”‚  (æœåŠ¡å™¨)       â”‚         â”‚  (ä¸Šè”äº¤æ¢æœº)     â”‚       â”‚
â”‚  â”‚                â”‚         â”‚                  â”‚       â”‚
â”‚  â”‚ â€¢ DHCP Server  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Port Config      â”‚       â”‚
â”‚  â”‚ â€¢ TFTP Server  â”‚         â”‚ VLAN Mgmt        â”‚       â”‚
â”‚  â”‚ â€¢ HTTP API     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”‚ â€¢ etcd Client  â”‚                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                 â”‚
â”‚           â”‚                          â”‚                 â”‚
â”‚           â”‚ Network: 192.168.100.0/24â”‚                 â”‚
â”‚           â”‚ (Installation VLAN 100)  â”‚                 â”‚
â”‚           â”‚                          â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Servers (PXE Boot)                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
â”‚  â”‚  â”‚Server-1â”‚  â”‚Server-2â”‚  â”‚Server-3â”‚  ...   â”‚      â”‚
â”‚  â”‚  â”‚(BMC)   â”‚  â”‚(BMC)   â”‚  â”‚(BMC)   â”‚        â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤šæœºæˆ¿éƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Control Plane (ç®¡ç†ä¸­å¿ƒ)                â”‚
â”‚                   â€¢ Web ç•Œé¢                              â”‚
â”‚                   â€¢ Task Management                       â”‚
â”‚                   â€¢ etcd Master                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                  â”‚     â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ DC1        â”‚    â”‚ DC2        â”‚    â”‚ DC3        â”‚
â”‚ Regional   â”‚    â”‚ Regional   â”‚    â”‚ Regional   â”‚
â”‚ Client     â”‚    â”‚ Client     â”‚    â”‚ Client     â”‚
â”‚            â”‚    â”‚            â”‚    â”‚            â”‚
â”‚ â€¢ DHCP     â”‚    â”‚ â€¢ DHCP     â”‚    â”‚ â€¢ DHCP     â”‚
â”‚ â€¢ TFTP     â”‚    â”‚ â€¢ TFTP     â”‚    â”‚ â€¢ TFTP     â”‚
â”‚ â€¢ Switch   â”‚    â”‚ â€¢ Switch   â”‚    â”‚ â€¢ Switch   â”‚
â”‚ â€¢ BMC      â”‚    â”‚ â€¢ BMC      â”‚    â”‚ â€¢ BMC      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚                 â”‚
   Servers           Servers           Servers
```

### å®¹å™¨åŒ–éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  regional-client:
    image: lpmos/regional-client:v3.0
    container_name: regional-client-dc1
    network_mode: host
    privileged: true
    volumes:
      - ./config.yaml:/etc/lpmos/config.yaml
      - ./tftpboot:/tftpboot
      - /var/log/lpmos:/var/log
    environment:
      - IDC=dc1
      - ETCD_ENDPOINTS=localhost:2379
    restart: unless-stopped
```

### Systemd æœåŠ¡

```ini
# /etc/systemd/system/regional-client.service
[Unit]
Description=LPMOS Regional Client
After=network.target etcd.service

[Service]
Type=simple
User=root
ExecStart=/usr/local/bin/regional-client --config /etc/lpmos/config.yaml
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

---

## ç›‘æŽ§å’ŒæŒ‡æ ‡

### Prometheus æŒ‡æ ‡

```
# HELP regional_client_dhcp_leases_total Total number of DHCP leases
# TYPE regional_client_dhcp_leases_total gauge
regional_client_dhcp_leases_total{idc="dc1"} 15

# HELP regional_client_tftp_requests_total Total number of TFTP requests
# TYPE regional_client_tftp_requests_total counter
regional_client_tftp_requests_total{idc="dc1",file="pxelinux.0"} 120

# HELP regional_client_tasks_total Total number of tasks by status
# TYPE regional_client_tasks_total gauge
regional_client_tasks_total{idc="dc1",status="pending"} 3
regional_client_tasks_total{idc="dc1",status="installing"} 5
regional_client_tasks_total{idc="dc1",status="completed"} 92

# HELP regional_client_bmc_operations_total Total BMC operations
# TYPE regional_client_bmc_operations_total counter
regional_client_bmc_operations_total{idc="dc1",operation="power_on"} 45
regional_client_bmc_operations_total{idc="dc1",operation="set_boot_pxe"} 45
```

### æ—¥å¿—æ ¼å¼

```json
{
  "time": "2026-01-30T16:00:00Z",
  "level": "info",
  "idc": "dc1",
  "module": "dhcp",
  "action": "lease_assigned",
  "mac": "00:1a:2b:3c:4d:5e",
  "ip": "192.168.100.10",
  "message": "DHCP lease assigned to server"
}
```

---

## å®‰å…¨è€ƒè™‘

### 1. ç½‘ç»œéš”ç¦»

- è£…æœºç½‘ç»œä¸Žç”Ÿäº§ç½‘ç»œéš”ç¦» (ä¸åŒ VLAN)
- DHCP/TFTP åªåœ¨è£…æœº VLAN ä¸­æä¾›æœåŠ¡
- è£…æœºå®ŒæˆåŽè‡ªåŠ¨åˆ‡æ¢åˆ°ç”Ÿäº§ VLAN

### 2. è®¿é—®æŽ§åˆ¶

- etcd ä½¿ç”¨ TLS + è®¤è¯
- BMC å¯†ç åŠ å¯†å­˜å‚¨
- äº¤æ¢æœºå‡­è¯ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡
- API è®¿é—®éœ€è¦è®¤è¯ token

### 3. å®¡è®¡æ—¥å¿—

- è®°å½•æ‰€æœ‰ç®¡ç†æ“ä½œ
- è®°å½•æ‰€æœ‰ BMC æŽ§åˆ¶å‘½ä»¤
- è®°å½•äº¤æ¢æœºé…ç½®å˜æ›´
- æ—¥å¿—é›†ä¸­å­˜å‚¨å’Œåˆ†æž

---

## æœªæ¥æ‰©å±•

### é˜¶æ®µ 1 (å½“å‰)
- âœ… åŸºç¡€ etcd ç›‘å¬
- âœ… Agent API æœåŠ¡
- â³ DHCP æœåŠ¡å™¨
- â³ TFTP æœåŠ¡å™¨

### é˜¶æ®µ 2
- â³ äº¤æ¢æœºè‡ªåŠ¨é…ç½®
- â³ BMC è‡ªåŠ¨æŽ§åˆ¶
- â³ PXE è‡ªåŠ¨åŒ–

### é˜¶æ®µ 3
- â³ å¤šæ“ä½œç³»ç»Ÿæ”¯æŒ
- â³ è‡ªå®šä¹‰å®‰è£…è„šæœ¬
- â³ å›¾å½¢åŒ– PXE èœå•

### é˜¶æ®µ 4
- â³ é«˜å¯ç”¨éƒ¨ç½²
- â³ è´Ÿè½½å‡è¡¡
- â³ è‡ªåŠ¨æ•…éšœè½¬ç§»

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0
**æœ€åŽæ›´æ–°**: 2026-01-30
**ç»´æŠ¤è€…**: LPMOS Team
